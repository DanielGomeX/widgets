$(document).ready(function(){function e(e,n){var t=e-.5+Math.random()*(n-e+1);return t=Math.round(t)}function n(e,n){var t="create"===n?$(".js-content-inner[data-clone=true]").clone().attr("data-clone","false"):$(".js-content-inner[data-clone=true]"),o="create"===n?$(".js-details[data-clone=true]").clone().attr("data-clone","false"):$(".js-details[data-clone=true]"),a="create"===n?$(".js-arrow[data-clone=true]").clone().attr("data-clone","false"):$(".js-arrow[data-clone=true]");t.find(".js-song").html(e.song),t.find(".js-artist").html(e.artist),t.find(".js-image").attr("src",e.image),o.find(".js-peak-val").html(e.peakPosition),o.find(".js-last-val").html(e.lastWeek),o.find(".js-on-chart-val").html(e.wksOnChart),e.lastWeek<e.place?a.addClass("down"):e.lastWeek>e.place&&a.addClass("up"),a.appendTo(".js-arrows"),t.appendTo(".js-content"),o.appendTo(".js-round")}function t(e){var n=e.targetNum-1;i.animate({top:144-e.position},1e3,function(){setTimeout(function(){$(".js-content").addClass("open")},200),setTimeout(function(){$(".js-content-ucho").addClass("open")},1e3),setTimeout(function(){$(".js-content-inner").eq(n).fadeIn(300)},1900),setTimeout(function(){$(".js-round").fadeIn(300).delay(300).addClass("open")},2300),setTimeout(function(){$(".js-details").eq(n).fadeIn(300),$(".js-arrow").eq(n).fadeIn(300),$(document).trigger("AnimationOpenFinished",[n])},3e3)})}function o(e){$(".js-details").eq(e).fadeOut(100),setTimeout(function(){$(".js-round").removeClass("open")},100),setTimeout(function(){$(".js-arrow").eq(e).fadeOut(300)},600),setTimeout(function(){$(".js-content-inner").eq(e).fadeOut(300)},600),setTimeout(function(){$(".js-content-ucho").removeClass("open")},800),setTimeout(function(){$(".js-content").removeClass("open")},1600),setTimeout(function(){var e=s();t(e),console.log(e)},2200)}function a(){var e=$(".content__block__num"),n=e.clone();i.append(n)}function s(){var n=e(1,50),t=$(".content__block__num"),o=[];return t.each(function(){$(this).html()==n&&o.push($(this))}),o[3].addClass("active"),{position:o[3].position().top,targetNum:n}}var c=$(".preloader"),r=$(".js-content1"),i=$(".content__block__counter__inner");try{var l,u;$.ajax({url:"https://js.dooh.xyz/top_songs/server/index.php",beforeSend:function(){l=new Date,u=l.getTime()},success:function(e){l=new Date,console.log((l.getTime()-u)/1e3);try{console.log("top songs data - ",JSON.parse(e)),e=JSON.parse(e);for(var i=0;2>i;i++)a();n(e[0],"new");for(var i=1;e.length>i;i++)n(e[i],"create");setTimeout(function(){var e=s();t(e),console.log(e)},600),$(document).on("AnimationOpenFinished",function(e,n){setTimeout(function(){o(n)},1e4)}),c.hide(),r.show()}catch(e){console.log(e),console.log("ошибка внутри ajax"),c.addClass("error")}},complete:function(){},error:function(e,n,t){console.log(e,n,t),c.addClass("error")}})}catch(e){console.log(e),console.log("ошибка ajax"),c.addClass("error")}});