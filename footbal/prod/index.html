<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>List of USA english</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900,900i&amp;subset=cyrillic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alice" rel="stylesheet">
    <style>.cssload-container {
  width: 100%;
  height: 49px;
  text-align: center;
}
.cssload-speeding-wheel {
  width: 49px;
  height: 49px;
  margin: 0 auto;
  border: 3px solid #fff;
  border-radius: 50%;
  border-left-color: transparent;
  border-right-color: transparent;
  animation: cssload-spin 1325ms infinite linear;
  -o-animation: cssload-spin 1325ms infinite linear;
  -ms-animation: cssload-spin 1325ms infinite linear;
  -webkit-animation: cssload-spin 1325ms infinite linear;
  -moz-animation: cssload-spin 1325ms infinite linear;
}
@keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@-webkit-keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
html,
body {
  margin: 0;
  padding: 0;
  width: 480px;
  height: 360px;
}
div {
  box-sizing: border-box;
}
a {
  text-decoration: none;
  color: inherit;
}
.placeholder {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: 'Oswald', sans-serif;
  /*font-family: 'Playfair Display', serif;
    font-family: 'Alice', serif;*/
  color: #fff;
  box-sizing: border-box;
  background: #fff;
}
.content {
  position: relative;
  width: 100%;
  z-index: 999;
  height: 100%;
}
.content__block {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  z-index: 0;
  font-size: 0;
  padding: 0 15px;
  height: 100%;
  width: 100%;
}
.preloader {
  position: absolute;
  top: 50%;
  margin-top: -25px;
  left: 50%;
  margin-left: -25px;
  width: auto;
  background: url('http://widgets/footbal/prod/server/images/ball.svg');
  width: 50px;
  height: 50px;
  background-size: 100%;
}
</style>
</head>
<body>
    <div class="placeholder">
        <div class="content">
            <div class="content__block js-block" data-clone="true">

            </div>
        </div>
        <div class="preloader">

        </div>
    </div>
<script>$(document).ready(function() {
    /* eslint no-console:0 */
    /* eslint eqeqeq: 0 */

    var translate = {
        ru: {
            title: 'Список Соединенных Штатов Америки',
            capital: 'Столица/Крупнейший город',
            population: 'Население',
            statehood: 'Дата основания',
            territory: {
                name: 'Территория',
                total: 'Всего',
                land: 'Земля',
                water: 'Вода'
            }
        },
        en: {
            title: 'List of Unated States of America',
            capital: 'Capital/largest city',
            population: 'Population',
            statehood: 'Statehood',
            territory: {
                name: 'Territory',
                total: 'Total',
                land: 'Land',
                water: 'Water'
            }
        }
    }

    /*function localization(lang) {
        lacalizeWidget(translate[lang]);
    }*/

    function lacalizeWidget(lang) {
        $('.js-capital').html(translate[lang].capital);
        $('.js-population').html(translate[lang].population);
        $('.js-statehood').html(translate[lang].statehood);
        $('.js-territory').html(translate[lang].territory.name);
        $('.js-territory-total').html(translate[lang].territory.total);
        $('.js-territory-land').html(translate[lang].territory.land);
        $('.js-territory-water').html(translate[lang].territory.water);
    }

    function createStructure(obj, lang, type) {
        var elem = type === 'create' ? $('.js-block[data-clone=true]').clone().attr('data-clone', 'false') : $('.js-block[data-clone=true]');
        elem.find('.js-largest-name').removeClass('two');
        elem.find('.js-capital-name').removeClass('two');

        elem.find('.js-state-title').html(obj.name);
        elem.find('.js-flag').attr('src', obj.flag);

        if (obj.capital == obj.largest_city) {
            elem.find('.js-largest-name').remove();
            elem.find('.js-capital-name').html(obj.capital);
        } else {
            elem.find('.js-largest-name').html(obj.largest_city).addClass('two');
            elem.find('.js-capital-name').html(obj.capital).addClass('two');
        }

        elem.find('.js-population-value').html(obj.population);
        elem.find('.js-statehood-value').html(obj.statehood);
        var system;

        if (lang === 'ru') {
            system = 'km'
        } else {
            system = 'mi'
        }
        //console.log(obj.territory.total[system])

        elem.find('.js-territory-total-value').html(obj.territory.total[system]);
        elem.find('.js-territory-land-value').html(obj.territory.land[system]);
        elem.find('.js-territory-water-value').html(obj.territory.water[system]);

        elem.appendTo('.content');
    }

    try {
        var time
          , startTime
          ;

        $.ajax({
            url: 'http://widgets/footbal/prod/server/redirect.php',
            beforeSend: function(){
                time = new Date();
                startTime = time.getTime();
            },
            success: function(d) {
                time = new Date();
                console.log((time.getTime() - startTime) / 1000);

                try {
                    console.log('sates_usa data - ', JSON.parse(d));

                    var obj
                      , lang
                      ;

                    d = JSON.parse(d);

                    for (var item in d) {
                        lacalizeWidget(item);
                        obj = d[item];
                        lang = item;
                    }

                    createStructure(obj[0], lang, 'new');

                    for (var i =1; obj.length > i; i++) {
                        createStructure(obj[i], lang, 'create');
                    }

                    var i = 1;
                    setInterval(function() {
                        if (i < obj.length) {
                            $('.js-block.active').removeClass('active')
                            $('.js-block').eq(i).addClass('active');
                            console.log(i);
                            i++;
                        } else {
                            i = 0;
                            $('.js-block').eq(i).addClass('active');
                        }

                    }, 6000)

                    $('.js-block').eq(0).addClass('active');

                    $('.content__wrapper').show();
                    $('.preloader').hide();
                } catch (e) {
                    console.log(e);
                    console.log('ошибка внутри ajax');
                }

            },
            complete: function() {},
            error: function(jqXHR, textStatus, errorThrown) {
                console.log(jqXHR, textStatus, errorThrown);
                $('.preloader').addClass('error')
            }
        })
    } catch (e) {
        console.log(e);
        console.log('ошибка ajax');
        $('.preloader').addClass('error')
    }
})</script>
</body>
</html>