$(document).ready(function(){function e(e){for(var a=0,t=0;e.length>t;t++)a+=e[t];return a/e.length}try{var a,t;$.ajax({url:"http://widgets/exchange_dynamics/prod/server/redirect.php",beforeSend:function(){a=new Date,t=a.getTime()},success:function(i){a=new Date,console.log((a.getTime()-t)/1e3);try{console.log("exchange_dynamics data - ",JSON.parse(i));var o=JSON.parse(i),s={};for(var n in o){s[n]={},s[n].labels=[],s[n].series=[];var r=[];for(var l in o[n])s[n].labels.push(l),r.push({meta:"descr",value:parseFloat(o[n][l].USD.replace(" RUB","").replace(",","."))}),s[n].series=new Array(r)}var d=[];for(var u in s)d.push(u);d.reverse(),console.log(s);var c={width:480,height:300,fullWidth:!0,showArea:!0};$(".header__mounth").html(d[0]);var m=new Chartist.Line(".ct-chart",s[d[0]],c);setTimeout(function(){$(".ct-line").addClass("show")},5500);var h=0;m.on("created",function(){h=0});var p=[];m.on("draw",function(e){if(h++,"label"===e.type&&"x"===e.axis)e.element.animate({y:{begin:80*h,dur:500,from:e.y+100,to:e.y,easing:"easeOutQuart"}});else if("label"===e.type&&"y"===e.axis)e.element.animate({x:{begin:80*h,dur:500,from:e.x-100,to:e.x,easing:"easeOutQuart"}});else if("point"===e.type)p[e.index]=e.value.y,e.element.animate({x1:{begin:80*h,dur:500,from:e.x-10,to:e.x,easing:"easeOutQuart"},x2:{begin:80*h,dur:500,from:e.x-10,to:e.x,easing:"easeOutQuart"},opacity:{begin:80*h,dur:500,from:0,to:1,easing:"easeOutQuart"}});else if("grid"===e.type){var a={begin:80*h,dur:500,from:e[e.axis.units.pos+"1"]-30,to:e[e.axis.units.pos+"1"],easing:"easeOutQuart"},t={begin:80*h,dur:500,from:e[e.axis.units.pos+"2"]-100,to:e[e.axis.units.pos+"2"],easing:"easeOutQuart"},i={};i[e.axis.units.pos+"1"]=a,i[e.axis.units.pos+"2"]=t,i.opacity={begin:80*h,dur:500,from:0,to:1,easing:"easeOutQuart"},e.element.animate(i)}});var g=1;m.on("created",function(a){var t=a.axisX.ticks.length*a.axisY.ticks.length*80-3e3;console.log(p);var i={};$(".js-direction").removeClass("down").removeClass("up"),p[0]>p[p.length-1]?(i.direction="down",i.diff=p[0]-p[p.length-1],$(".js-direction").addClass("down").html("- "+i.diff.toFixed(2)+" ₽")):(i.direction="up",i.diff=p[p.length-1]-p[0],$(".js-direction").addClass("up").html("+ "+i.diff.toFixed(2)+" ₽")),$(".js-direction").addClass("show"),$(".js-descr-max").html(Math.max.apply(Math,p).toFixed(2)),$(".js-descr-min").html(Math.min.apply(Math,p).toFixed(2)),$(".js-descr-average").html(e(p).toFixed(2)),setTimeout(function(){$(".js-description").addClass("active")},t+3e3),window.__exampleAnimateTimeout&&(clearTimeout(window.__exampleAnimateTimeout),window.__exampleAnimateTimeout=null),window.__exampleAnimateTimeout=setTimeout(function(){g<d.length?(setTimeout(function(){$(".ct-line").addClass("show")},t),$(".header__mounth").html(d[g]),$(".js-description").removeClass("active"),m.update(s[d[g]]),g++):(g=0,$(".header__mounth").html(d[g]),$(".js-description").removeClass("active"),m.update(s[d[g]]))},18e3)}),$(".content__wrapper").show(),$(".js-block").eq(0).fadeIn(500).addClass("active"),$(".preloader").hide()}catch(e){console.log(e),console.log("ошибка внутри ajax")}},complete:function(){},error:function(e,a,t){console.log(e,a,t),$(".preloader").addClass("error")}})}catch(e){console.log(e),console.log("ошибка ajax"),$(".preloader").addClass("error")}});