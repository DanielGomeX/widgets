<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Динамика курса</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900,900i&amp;subset=cyrillic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alice" rel="stylesheet">
    <!-- Chartist.js -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <!--  -->
    <style>.cssload-container {
  width: 100%;
  height: 49px;
  text-align: center;
}
.cssload-speeding-wheel {
  width: 49px;
  height: 49px;
  margin: 0 auto;
  border: 3px solid #fff;
  border-radius: 50%;
  border-left-color: transparent;
  border-right-color: transparent;
  animation: cssload-spin 1325ms infinite linear;
  -o-animation: cssload-spin 1325ms infinite linear;
  -ms-animation: cssload-spin 1325ms infinite linear;
  -webkit-animation: cssload-spin 1325ms infinite linear;
  -moz-animation: cssload-spin 1325ms infinite linear;
}
@keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@-webkit-keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
html,
body {
  margin: 0;
  padding: 0;
  width: 480px;
  height: 360px;
}
div {
  box-sizing: border-box;
}
a {
  text-decoration: none;
  color: inherit;
}
.placeholder {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: 'Oswald', sans-serif;
  /*font-family: 'Playfair Display', serif;
    font-family: 'Alice', serif;*/
  color: #000;
  box-sizing: border-box;
  background: #fff;
  border: 1px solid #d4d4d4;
}
.header {
  font-size: 35px;
  padding: 0 50px;
}
.header__title {
  display: inline-block;
  margin-right: 15px;
}
.content {
  width: 100%;
  height: 100%;
}
.content__chart {
  position: absolute;
  top: 60px;
  height: 300px;
}
.ct-line {
  stroke-width: 3px;
}
.ct-point {
  stroke-width: 7px;
  stroke-linecap: round;
}
.ct-series-a .ct-line,
.ct-series-a .ct-point {
  stroke: #85BB65;
}
.ct-series-b .ct-line,
.ct-series-b .ct-point {
  stroke: blue;
}
.cssload-container.preloader {
  position: absolute;
  top: 50%;
  margin-top: -29px;
  left: 50%;
  margin-left: -29px;
  width: auto;
}
.cssload-container.preloader .cssload-speeding-wheel {
  border-left-color: #000;
  border-right-color: #000;
}
.cssload-container.preloader.error .cssload-speeding-wheel {
  border-left-color: #fff;
  border-right-color: #fff;
  border-top-color: red;
  border-bottom-color: red;
}
</style>
</head>
<body>
    <div class="placeholder">
        <div class="header">
            <span class="header__title">Курс <span class="header__currency-name">USD</span>      </span>
            <span class="header__mounth">Апрель</span>
            <span class="header__year">2017 г.</span>
        </div>
        <div class="content">
            <div class="ct-chart ct-perfect-fourth content__chart"></div>
        </div>
        <div class="cssload-container preloader">
            <div class="cssload-speeding-wheel"></div>
        </div>
    </div>
<script>$(document).ready(function() {
    /* eslint no-console:0 */
    /* eslint eqeqeq: 0 */



    try {
        var time
          , startTime
          ;

        $.ajax({
            url: 'http://localhost/widgets_git/exchange_dynamics/prod/server/rate.json',
            beforeSend: function(){
                time = new Date();
                startTime = time.getTime();
            },
            success: function(d) {
                time = new Date();
                console.log((time.getTime() - startTime) / 1000);

                try {
                    //console.log('footwear - data', d);
                    var days = [];
                    var currencyUSDVal = []
                      , currencyEURVal = []
                      ;


                    var response = d;
                    var data = {};

                    for (var mounth in response) {
                        //console.log(mounth);

                        data[mounth] = {};
                        data[mounth].labels = [];
                        data[mounth].series = [];
                        var arr = [];

                        for (var item in response[mounth]) {
                            //console.log(item);
                            //data[mounth].labels = [];
                            data[mounth].labels.push(item);

                            arr.push(parseFloat(response[mounth][item]['USD'].replace(' RUB', '').replace(',','.')));
                            data[mounth].series = new Array(arr);
                        }
                    }

                    console.log(data);  



                    //new Chartist.Line('.ct-chart', data['апрель'], options);
                    var delay = 6000;

                    for (var mounth in data) {
                        setTimeout(function() {
                            Chartist.Line('.ct-chart', data[mounth], options);
                            $('.header__mounth').html(mounth);
                            console.log(data[mounth])
                        },delay)

                        delay = delay + delay;
                    }    
                

                    /*for (var item in d['апрель']) {
                        days.push(item);


                        currencyUSDVal.push(parseFloat(d['апрель'][item]['USD'].replace(' RUB', '').replace(',','.')));
                        currencyEURVal.push(parseFloat(d['апрель'][item]['EUR'].replace(' RUB', '').replace(',','.')));
                    }


                    var data = {
                        labels: days,
                        series: [
                            currencyUSDVal,
                            //currencyEURVal
                        ]
                    };*/

                    var options = {
                        width: 480,
                        height: 300
                    };

                    /*new Chartist.Line('.ct-chart', data, options);

                    setTimeout(function() {
                        data.series.push(currencyEURVal);
                        Chartist.Line('.ct-chart', data, options);

                    }, 3000)*/

                    $('.content__wrapper').show();
                    $('.js-block').eq(0).fadeIn(500).addClass('active');
                    $('.preloader').hide();
                } catch (e) {
                    console.log(e);
                    console.log('ошибка внутри ajax');
                }

            },
            complete: function() {},
            error: function(jqXHR, textStatus, errorThrown) {
                console.log(jqXHR, textStatus, errorThrown);
                $('.preloader').addClass('error')
            }
        })
    } catch (e) {
        console.log(e);
        console.log('ошибка ajax');
        $('.preloader').addClass('error')
    }

    function createStructure (data, type) {
        var elem = type === 'create' ? $('.js-block[data-clone=true]').clone().attr('data-clone', 'false') : $('.js-block[data-clone=true]');

        if (data.image) {
            elem.find('.js-image').attr('src',  data.image);
        }

        if (data.title) {
            elem.find('.js-title').html(data.title);
        }

        if (data.description){
            elem.find('.js-description').html(cutStr(data.description, 145));
        }

        for (var i = 0; 2 > i;i++) {
            elem.find('.js-footer').append('<div class="content__tag">' + data.category[i] + '</div>');
        }


        elem.appendTo('.content__wrapper');
    }
})</script>
</body>
</html>