<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Attraction</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="http://widgets/attraction/prod/server/handlebars-latest.js"></script>
    <script type="text/javascript" src="http://widgets/attraction/prod/server/slick.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900,900i&amp;subset=cyrillic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alice" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:700,800" rel="stylesheet">
    <style>.bubblingG {
  text-align: center;
  width: 78px;
  height: 49px;
  margin: auto;
}
.bubblingG span {
  display: inline-block;
  vertical-align: middle;
  width: 10px;
  height: 10px;
  margin: 24px auto;
  background: #000000;
  border-radius: 49px;
  -o-border-radius: 49px;
  -ms-border-radius: 49px;
  -webkit-border-radius: 49px;
  -moz-border-radius: 49px;
  animation: bubblingG 1.5s infinite alternate;
  -o-animation: bubblingG 1.5s infinite alternate;
  -ms-animation: bubblingG 1.5s infinite alternate;
  -webkit-animation: bubblingG 1.5s infinite alternate;
  -moz-animation: bubblingG 1.5s infinite alternate;
}
#bubblingG_1 {
  animation-delay: 0s;
  -o-animation-delay: 0s;
  -ms-animation-delay: 0s;
  -webkit-animation-delay: 0s;
  -moz-animation-delay: 0s;
}
#bubblingG_2 {
  animation-delay: 0.45s;
  -o-animation-delay: 0.45s;
  -ms-animation-delay: 0.45s;
  -webkit-animation-delay: 0.45s;
  -moz-animation-delay: 0.45s;
}
#bubblingG_3 {
  animation-delay: 0.9s;
  -o-animation-delay: 0.9s;
  -ms-animation-delay: 0.9s;
  -webkit-animation-delay: 0.9s;
  -moz-animation-delay: 0.9s;
}
@keyframes bubblingG {
  0% {
    width: 10px;
    height: 10px;
    background-color: #000000;
    -webkit-transform: translateY(0);
            transform: translateY(0);
  }
  100% {
    width: 23px;
    height: 23px;
    background-color: #ffffff;
    -webkit-transform: translateY(-20px);
            transform: translateY(-20px);
  }
}
@-webkit-keyframes bubblingG {
  0% {
    width: 10px;
    height: 10px;
    background-color: #000000;
    -webkit-transform: translateY(0);
  }
  100% {
    width: 23px;
    height: 23px;
    background-color: #ffffff;
    -webkit-transform: translateY(-20px);
  }
}
html,
body {
  margin: 0;
  padding: 0;
  width: 480px;
  height: 360px;
}
div {
  box-sizing: border-box;
}
a {
  text-decoration: none;
  color: inherit;
}
.fake {
  display: inline-block;
  vertical-align: middle;
  height: 100%;
}
.placeholder {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: 'Alice', serif;
  color: #222;
  box-sizing: border-box;
  background-color: #FF3CAC;
  background-image: linear-gradient(225deg, #FF3CAC 0%, #784BA0 50%, #2B86C5 100%);
  -webkit-filter: drop-shadow(0px 10px 40px rgba(0, 0, 0, 0.55));
          filter: drop-shadow(0px 10px 40px rgba(0, 0, 0, 0.55));
}
.placeholder__bg {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}
.content {
  position: relative;
  width: 100%;
  z-index: 999;
  height: 100%;
  display: block;
  z-index: 2;
}
.content__block {
  width: 100%;
  height: 100%;
  text-align: center;
  color: #222;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  transition: All .4s ease;
}
.content__block.active {
  opacity: 1;
}
.content__block__header {
  position: absolute;
  width: 100%;
  color: #fff;
  box-sizing: border-box;
  left: 0;
  padding: 0 40px;
}
.content__block__title {
  font-size: 30px;
  line-height: 30px;
  font-weight: bold;
}
.content__block__address {
  font-size: 20px;
  line-height: 22px;
}
.content__block__description {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  color: #fff;
  font-size: 24px;
  padding: 10px 0;
}
.preloader {
  display: none;
  position: absolute;
  top: 35%;
  margin-top: -48px;
  left: 50%;
  z-index: 99999;
}
* {
  outline: none;
  box-sizing: border-box;
}
body {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  overflow: hidden;
}
.slick-slider {
  position: absolute;
  top: 100px;
}
.slick-track {
  will-change: transform;
}
.slick-list {
  overflow: visible;
  will-change: transform;
}
.slick-slide {
  padding: 0;
  width: 480px;
}
.slick-slide img {
  max-width: 60%;
  margin: 0 auto;
}
[type="button"] {
  position: fixed;
  top: 50%;
  z-index: 10;
  width: 70px;
  height: 70px;
  overflow: hidden;
  border: 0;
  text-indent: -9999px;
  background-color: black;
  background-position: center;
  background-repeat: no-repeat;
  cursor: pointer;
  opacity: 0.9;
  -webkit-transform: translateY(-50%);
          transform: translateY(-50%);
  transition: all 0.25s ease;
}
[type="button"]:hover {
  opacity: 1;
}
[type="button"].slick-next {
  right: 0;
  background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjx0aXRsZT5jaGV2cm9uLXJpZ2h0PC90aXRsZT48cGF0aCBmaWxsPSIjZmZmZmZmIiBkPSJNMTUuNzA2IDExLjI5NGwtNi02Yy0wLjM4Ny0wLjM4Ny0xLjAyNS0wLjM4Ny0xLjQxMyAwcy0wLjM4NyAxLjAyNSAwIDEuNDEzbDUuMjk0IDUuMjk0LTUuMjk0IDUuMjk0Yy0wLjM4NyAwLjM4Ny0wLjM4NyAxLjAyNSAwIDEuNDEzIDAuMTk0IDAuMTk0IDAuNDUgMC4yOTQgMC43MDYgMC4yOTRzMC41MTMtMC4xIDAuNzA2LTAuMjk0bDYtNmMwLjM5NC0wLjM4NyAwLjM5NC0xLjAyNSAwLTEuNDEzeiI+PC9wYXRoPjwvc3ZnPg==);
}
[type="button"].slick-next:hover {
  right: -5px;
}
[type="button"].slick-prev {
  left: 0;
  background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjx0aXRsZT5jaGV2cm9uLWxlZnQ8L3RpdGxlPjxwYXRoIGZpbGw9IiNmZmZmZmYiIGQ9Ik0xMC40MTMgMTJsNS4yOTQtNS4yOTRjMC4zODctMC4zODcgMC4zODctMS4wMjUgMC0xLjQxM3MtMS4wMjUtMC4zODctMS40MTMgMGwtNiA2Yy0wLjM4NyAwLjM4Ny0wLjM4NyAxLjAyNSAwIDEuNDEzbDYgNmMwLjE5NCAwLjE5NCAwLjQ1IDAuMjk0IDAuNzA2IDAuMjk0czAuNTEzLTAuMSAwLjcwNi0wLjI5NGMwLjM4Ny0wLjM4NyAwLjM4Ny0xLjAyNSAwLTEuNDEzbC01LjI5NC01LjI5NHoiPjwvcGF0aD48L3N2Zz4=);
}
[type="button"].slick-prev:hover {
  left: -5px;
}
@-webkit-keyframes motion-blur {
  0% {
    -webkit-filter: url(#blur0);
            filter: url(#blur0);
    -webkit-transform: scale(1, 1);
            transform: scale(1, 1);
  }
  15% {
    -webkit-filter: url(#blur1);
            filter: url(#blur1);
    -webkit-transform: scale(1, 0.98);
            transform: scale(1, 0.98);
  }
  30% {
    -webkit-filter: url(#blur2);
            filter: url(#blur2);
    -webkit-transform: scale(1, 0.93);
            transform: scale(1, 0.93);
  }
  45% {
    -webkit-filter: url(#blur3);
            filter: url(#blur3);
    -webkit-transform: scale(1.1, 0.9);
            transform: scale(1.1, 0.9);
  }
  60% {
    -webkit-filter: url(#blur4);
            filter: url(#blur4);
    -webkit-transform: scale(1.2, 0.88);
            transform: scale(1.2, 0.88);
  }
  75%,
  100% {
    -webkit-filter: url(#blur5);
            filter: url(#blur5);
    -webkit-transform: scale(1.35, 0.85);
            transform: scale(1.35, 0.85);
  }
}
@keyframes motion-blur {
  0% {
    -webkit-filter: url(#blur0);
            filter: url(#blur0);
    -webkit-transform: scale(1, 1);
            transform: scale(1, 1);
  }
  15% {
    -webkit-filter: url(#blur1);
            filter: url(#blur1);
    -webkit-transform: scale(1, 0.98);
            transform: scale(1, 0.98);
  }
  30% {
    -webkit-filter: url(#blur2);
            filter: url(#blur2);
    -webkit-transform: scale(1, 0.93);
            transform: scale(1, 0.93);
  }
  45% {
    -webkit-filter: url(#blur3);
            filter: url(#blur3);
    -webkit-transform: scale(1.1, 0.9);
            transform: scale(1.1, 0.9);
  }
  60% {
    -webkit-filter: url(#blur4);
            filter: url(#blur4);
    -webkit-transform: scale(1.2, 0.88);
            transform: scale(1.2, 0.88);
  }
  75%,
  100% {
    -webkit-filter: url(#blur5);
            filter: url(#blur5);
    -webkit-transform: scale(1.35, 0.85);
            transform: scale(1.35, 0.85);
  }
}
.do-transition {
  -webkit-animation: motion-blur 0.1s linear forwards, motion-blur 0.4s linear reverse forwards 0.1s;
          animation: motion-blur 0.1s linear forwards, motion-blur 0.4s linear reverse forwards 0.1s;
}
</style>
    <style>/* Slider */
.slick-slider
{
    position: relative;

    display: block;
    box-sizing: border-box;

    -webkit-user-select: none;
       -moz-user-select: none;
        -ms-user-select: none;
            user-select: none;

    -webkit-touch-callout: none;
    -khtml-user-select: none;
    -ms-touch-action: pan-y;
        touch-action: pan-y;
    -webkit-tap-highlight-color: transparent;
}

.slick-list
{
    position: relative;

    display: block;
    overflow: hidden;

    margin: 0;
    padding: 0;
}
.slick-list:focus
{
    outline: none;
}
.slick-list.dragging
{
    cursor: pointer;
    cursor: hand;
}

.slick-slider .slick-track,
.slick-slider .slick-list
{
    -webkit-transform: translate3d(0, 0, 0);
       -moz-transform: translate3d(0, 0, 0);
        -ms-transform: translate3d(0, 0, 0);
         -o-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
}

.slick-track
{
    position: relative;
    top: 0;
    left: 0;

    display: block;
}
.slick-track:before,
.slick-track:after
{
    display: table;

    content: '';
}
.slick-track:after
{
    clear: both;
}
.slick-loading .slick-track
{
    visibility: hidden;
}

.slick-slide
{
    display: none;
    float: left;

    height: 100%;
    min-height: 1px;
}
[dir='rtl'] .slick-slide
{
    float: right;
}
.slick-slide img
{
    display: block;
}
.slick-slide.slick-loading img
{
    display: none;
}
.slick-slide.dragging img
{
    pointer-events: none;
}
.slick-initialized .slick-slide
{
    display: block;
}
.slick-loading .slick-slide
{
    visibility: hidden;
}
.slick-vertical .slick-slide
{
    display: block;

    height: auto;

    border: 1px solid transparent;
}
.slick-arrow.slick-hidden {
    display: none;
}
</style>
</head>
<body>
    <div class="placeholder">
        <div class="content js-content">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                       width="0" height="0" viewBox="0 0 1366 768" xml:space="preserve">
              <defs>
                <filter id="blur0">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="0 0" />
                </filter>
                <filter id="blur1">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="5 0" />
                </filter>
                <filter id="blur2">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="12 0" />
                </filter>
                <filter id="blur3">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="20 0" />
                </filter>
                <filter id="blur4">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="35 1" />
                </filter>
                <filter id="blur5">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="50 1" />
                </filter>
              </defs>
            </svg>

            <script id="template" type="text/x-handlebars-template">
                {{#each results}}
                    <div class="content__block js-block">
                        <div class="content__block__header">
                            <div class="content__block__title">{{ short_title }}</div>
                            <div class="content__block__address">{{ images.thumbnails.['640x384'] }}</div>
                        </div>
                        <div class="slider">
                            {{#each images}}
                                <div>
                                    <img src="{{ thumbnails.['640x384'] }}" alt="">
                                </div>
                            {{/each}}
                        </div>
                        <marquee class="content__block__description" behavior="scroll" direction="left" bgcolor="">{{ description }}</marquee>
                    </div>
                {{/each}}
            </script>
        </div>
        <div class="cssload-wrapper preloader">
            <div class="cssload-square"></div>
            <div class="cssload-square"></div>
            <div class="cssload-square"></div>
            <div class="cssload-square"></div>
            <div class="cssload-square"></div>
        </div>
        <div class="placeholder__bg js-bg"></div>
    </div>
<script>$(document).ready(function() {
    /* eslint no-console:0 */
    /* eslint eqeqeq: 0 */

    var time
      , startTime
      ;

    var $preloader
      , $content = $('.content')
      ;



    $.ajax({
        url: 'http://widgets/attraction/prod/server/index.php',
        beforeSend: function(){
            time = new Date();
            startTime = time.getTime();
        },
        success: function(d) {
            time = new Date();
            console.log((time.getTime() - startTime) / 1000);

            try {
                console.log('attractions - ', JSON.parse(d));

                d = JSON.parse(d);

                var data = d;

                console.log('123',data.results[0].images[0].thumbnails['640x384']);

                var template = Handlebars.compile( $('#template').html() );
                $content.append( template(data) );


                $('.slider').eq(0).on('init', function(slick){
                    $('.js-block').eq(0).addClass('active');
                    animateImg(0);
                })

                // Slick slider init
                $('.slider').slick({
                    arrows: false,
                    dots: false,
                    infinite: true,
                    speed: 500,
                    slidesToShow: 1,
                    centerMode: true,
                    variableWidth: true,
                    draggable: false
                });

                $('.slider')
                    .on('beforeChange', function(event, slick, currentSlide, nextSlide){
                        $('.slick-list').addClass('do-transition')
                    })
                    .on('afterChange', function(){
                        $('.slick-list').removeClass('do-transition')
                    });



                /*$preloader.hide();
                $content.show();*/
            } catch (e) {
                console.log(e);
                console.log('ошибка внутри ajax');
                $preloader.addClass('error');
            }

        },
        complete: function() {},
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR, textStatus, errorThrown);
            $preloader.addClass('error')
        }
    })

    function animateImg(blockIndex) {
        var block = $('.js-block').eq(blockIndex);
        var image = block.find('img')
        var imageCount = image.length;

        var slider = block.find('.slider');
        var i = 1;

        var timerId = setTimeout(function tick() {
            if (i < imageCount) {
                slider.slick('slickNext');
                i++;
            } else {
                i = 0;
                $(window).trigger('imageAnimateFinish');
                clearTimeout(timerId);
                return;
            }

            timerId = setTimeout(tick, 2000);
        }, 2000);

    }

    $(window).on('imageAnimateFinish', function() {
        var activeIndex = $('.js-block.active').index();
        $('.js-block.active').removeClass('active');

        $('.js-block').eq(activeIndex + 1).addClass('active');
        animateImg(activeIndex + 1);
    });



})</script>
</body>
</html>