<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Results of Football matches England</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900,900i&amp;subset=cyrillic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alice" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:700,800" rel="stylesheet">
    <style>.cssload-container {
  width: 100%;
  height: 49px;
  text-align: center;
}
.cssload-speeding-wheel {
  width: 49px;
  height: 49px;
  margin: 0 auto;
  border: 3px solid #fff;
  border-radius: 50%;
  border-left-color: transparent;
  border-right-color: transparent;
  animation: cssload-spin 1325ms infinite linear;
  -o-animation: cssload-spin 1325ms infinite linear;
  -ms-animation: cssload-spin 1325ms infinite linear;
  -webkit-animation: cssload-spin 1325ms infinite linear;
  -moz-animation: cssload-spin 1325ms infinite linear;
}
@keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@-webkit-keyframes cssload-spin {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
html,
body {
  margin: 0;
  padding: 0;
  width: 480px;
  height: 360px;
}
div {
  box-sizing: border-box;
}
a {
  text-decoration: none;
  color: inherit;
}
</style>
</head>
<body>
    <div class="header">
        <h3>Заказы</h3>
    </div>
    <div class="content">

    </div>
<script>$(document).ready(function() {
    /* eslint no-console:0 */
    /* eslint eqeqeq: 0 */

    function createStructure(obj, side) {
        //console.log(obj);
        var elem = side === 'front' ? $('.js-block-front[data-clone=true]') : $('.js-block-back[data-clone=true]');

    }

    function sendNotification(title, options) {
        // Проверим, поддерживает ли браузер HTML5 Notifications
        if (!("Notification" in window)) {
            alert('Ваш браузер не поддерживает HTML Notifications, его необходимо обновить.');
        } else if (Notification.permission === "granted") {
            // Если права есть, отправим уведомление
            var notification = new Notification(title, options);

            /*function clickFunc() {
                alert('Пользователь кликнул на уведомление');
            }

            notification.onclick = clickFunc;*/
        } else if (Notification.permission !== 'denied') {
            Notification.requestPermission(function (permission) {
                // Если права успешно получены, отправляем уведомление
                if (permission === "granted") {
                    var notification = new Notification(title, options);
                } else {
                    alert('Вы запретили показывать уведомления'); // Юзер отклонил наш запрос на показ уведомлений
                }
            });
        } else {
            // Пользователь ранее отклонил наш запрос на показ уведомлений
            // В этом месте мы можем, но не будем его беспокоить. Уважайте решения своих пользователей.
        }
    }

    try {
        var time
          , startTime
          ;


        setInterval(function() {
            $.ajax({
                url: 'http://widgets/freelansim/prod/server/index.php',
                beforeSend: function(){
                    time = new Date();
                    startTime = time.getTime();
                },
                success: function(d) {
                    time = new Date();
                    console.log((time.getTime() - startTime) / 1000);

                    try {
                        console.log('freelansim data - ', JSON.parse(d));
                        //console.log('football data - ', d);

                        d = JSON.parse(d);

                        var newLine = d.status.newLine
                        //console.log(d.status.newLine);

                        if (newLine != 0) {
                            console.log($(this).title);
                            console.log($(this).description);
                            for (var i = 0;d.orders.length > i; i++) {
                                sendNotification('<a href="'+ d.orders[i].link +'">' + d.orders[i].title + '</a>', {
                                    body: d.orders[i].description
                                })
                            }
                        } else {
                            sendNotification('Количество заказов 0', {
                                body: 'Наверное еще никому ничего не нужно',
                                icon: 'http://widgets/freelansim/prod/server/images/null.png'
                            })
                        }


                    } catch (e) {
                        console.log(e);
                        console.log('ошибка внутри ajax');
                    }

                },
                complete: function() {},
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR, textStatus, errorThrown);
                    $('.preloader').addClass('error')
                }
            })

        }, 120000)
    } catch (e) {
        console.log(e);
        console.log('ошибка ajax');
        $('.preloader').addClass('error')
    }
})</script>
</body>
</html>