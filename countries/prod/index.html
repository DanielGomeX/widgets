<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Страны мира</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900,900i&amp;subset=cyrillic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alice" rel="stylesheet">
    <style>html,
body {
  margin: 0;
  padding: 0;
  width: 480px;
  height: 360px;
}
div {
  box-sizing: border-box;
}
.placeholder {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  /*font-family: 'Oswald', sans-serif;
    font-family: 'Playfair Display', serif;*/
  font-family: 'Alice', serif;
  color: #000;
  border: 2px solid #000;
  box-sizing: border-box;
  background: url('https://image.freepik.com/free-vector/abstract-gray-background-with-lines_1108-73.jpg') center;
}
.content {
  width: 100%;
  height: 100%;
}
.block {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
}
.block.active {
  opacity: 1;
}
.block__title {
  display: block;
  text-align: center;
  font-size: 40px;
  line-height: 40px;
  font-weight: bold;
  padding: 15px;
  font-family: 'Oswald', sans-serif;
}
.block__title__text {
  display: inline-block;
  vertical-align: middle;
}
.block__title__img {
  display: inline-block;
  vertical-align: bottom;
}
.block__title__gerb,
.block__title__flag {
  opacity: 0;
  max-width: 50px;
}
.block__title__gerb.min,
.block__title__flag.min {
  -webkit-transform: scale(1) translate(0, 0);
          transform: scale(1) translate(0, 0);
  transition: All 1s ease;
  opacity: 1;
}
.block__title__gerb {
  -webkit-transform: scale(6.5) translate(-17px, 25px);
          transform: scale(6.5) translate(-17px, 25px);
}
.block__title__flag {
  -webkit-transform: scale(5.5) translate(-11px, 30px);
          transform: scale(5.5) translate(-11px, 30px);
}
.block__content {
  opacity: 0;
}
.block__content.active {
  opacity: 1;
  transition: All 1s ease;
}
.block__caption {
  font-size: 25px;
  font-weight: 500;
  letter-spacing: 1.2px;
}
.block__row {
  font-size: 0;
  padding: 30px 15px 0;
}
.block__row:first-child {
  padding-top: 15px;
}
.block__row__col {
  font-size: 20px;
  display: inline-block;
  vertical-align: middle;
  width: 60%;
}
.block__row__col:last-child {
  width: 40%;
}
.block__row__col:last-child:first-letter {
  text-transform: uppercase;
}
.block__text {
  display: inline-block;
  line-height: 22px;
}
.block__img {
  max-height: 40px;
}
</style>
</head>
<body>
    <div class="placeholder">
        <div class="content">
            <div class="block js-block" data-clone="true">
                <div class="block__title">
                    <span class="block__title__text js-title"></span>
                    <img src="" class="block__title__img block__title__flag block__img js-flag">
                    <img src="" class="block__title__img block__title__gerb block__img js-gerb">
                </div>
                <div class="block__content">
                    <div class="block__row">
                        <div class="block__row__col">
                            <span class="block__caption">Столица</span>
                        </div>
                        <div class="block__row__col js-capital"></div>
                    </div>
                    <div class="block__row">
                        <div class="block__row__col">
                            <span class="block__caption">Местные жители</span>
                        </div>
                        <div class="block__row__col js-locals"></div>
                    </div>
                    <div class="block__row">
                        <div class="block__row__col">
                            <span class="block__caption">Валюта</span>
                        </div>
                        <div class="block__row__col js-currency"></div>
                    </div>
                    <div class="block__row">
                        <div class="block__row__col">
                            <span class="block__caption">Телефонный код</span>
                        </div>
                        <div class="block__row__col  js-phone-code"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="preloader">
            <div>http://widgets/</div>
        </div>
    </div>
<script>$(document).ready(function() {
    /* eslint no-console:0 */
    $.ajax({
        url: 'http://widgets/countries/prod/server/info_new.json',
        success: function(d) {
            console.log('country_data', d);

            createStructure(d['Австралия'], 'new');
            d.length = 0;
            for (var item in d) {
                var itObj = d[item];
                d.length++;
                if (item != 'Австралия') {
                    createStructure(itObj, 'create');
                }
            }

            var it = 0;
            setTimeout(function() {
                animate(randomInteger(0, 88)[it]);
            }, 2000)


        },
        complete: function() {}
    })

    function createStructure (data, type) {
        var elem = type === 'create' ? $('.js-block[data-clone=true]').clone(true).attr('data-clone', 'false') : $('.js-block[data-clone=true]');

        elem.find('.js-flag').attr('src', data.flag);
        elem.find('.js-title').html(data.ru_name);
        elem.find('.js-title').closest('.block').attr('title', data.ru_name);
        elem.find('.js-gerb').attr('src', data.gerb);
        elem.find('.js-capital').html(data.capital);

        if (data.locals != undefined) {
            elem.find('.js-locals').html(data.locals);
        } else {
            elem.find('.js-locals').closest('.block__row').css('display', 'none');
        }

        if (data.currency != undefined) {
            elem.find('.js-currency').html(data.currency);
        } else {
            elem.find('.js-currency').closest('.block__row').css('display', 'none');
        }

        if (data.phone_code != undefined) {
            elem.find('.js-phone-code').html(data.phone_code);
        } else {
            elem.find('.js-phone-code').closest('.block__row').css('display', 'none');
        }

        elem.appendTo('.content')
    }

    function animate(i) {
        var item = $('.js-block').eq(i);

        item.addClass('active');
        item.find('.js-flag').animate({
            'opacity': 1
        }, 500)

        setTimeout(function() {
            item.find('.js-flag').addClass('min');

        }, 1500)

        setTimeout(function() {
            item.find('.js-gerb').animate({
                'opacity': 1
            }, 500)
        }, 1800)

        setTimeout(function() {
            item.find('.js-gerb').addClass('min');
            item.find('.block__content').addClass('active');
        }, 3600)

        /*item.find('.js-flag').addClass('min');
        item.find('.js-gerb').addClass('min');*/

        /*setTimeout(function() {
            item.find('.block__content').addClass('active');
        }, 1300)*/

        setTimeout(function() {
            item.removeClass('active');
            animate(randomInteger(0, 88)[i + 1]);
        }, 8000)

    }

    function randomInteger (min, max) {
        var totalNumbers        = max - min + 1,
            arrayTotalNumbers   = [],
            arrayRandomNumbers  = [],
            tempRandomNumber;

        while (totalNumbers--) {
            arrayTotalNumbers.push(totalNumbers + min);
        }

        while (arrayTotalNumbers.length) {
            tempRandomNumber = Math.round(Math.random() * (arrayTotalNumbers.length - 1));
            arrayRandomNumbers.push(arrayTotalNumbers[tempRandomNumber]);
            arrayTotalNumbers.splice(tempRandomNumber, 1);
        }

        return arrayRandomNumbers;
    }

})</script>
</body>
</html>